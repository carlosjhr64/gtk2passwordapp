#!/usr/bin/env ruby
require 'rubygems'
gem 'gtk2applib', '~> 3.1.0'
require 'gtk2applib/gtk2_app'

application = {
	:name		=> 'Ruby-Gnome Password Manager',
	:tooltip	=> 'Password Manager',
	:FILE		=> __FILE__,
	}
Gtk2App.init(application)
Gtk2App.icon.set_icon_name(Gtk::Stock::DIALOG_AUTHENTICATION)

require 'gtk2passwordapp/edit_box.rb'
require 'gtk2passwordapp/passwords.rb'
menu = Gtk2App::Menu.new
passwords = Gtk2PasswordApp::Passwords.new
Gtk2PasswordApp.build_menu(menu,passwords)
menu.show_all

Gtk2App.icon.signal_connect('popup-menu'){ menu.popup(nil, nil, 0, 0) }

about = {
	:authors	=> ['carlosjhr64@gmail.com'],
	:comments	=> 'Ruby-Gtk2 Passsword Manager',
	:website	=> 'http://ruby-gnome-apps.blogspot.com/search/label/Passwords',
	:website_label	=> 'Ruby-Gnome Password Manager',
	:license	=> 'GPL',
	:copyright	=> '2010-Jan-1',
	}
Gtk2App.main_window(about) do |window|
  Gtk2PasswordApp.edit(window,menu,passwords)
end

# To avoid segmentation fault
menu.children.each{|child| child.destroy}
menu.destroy
