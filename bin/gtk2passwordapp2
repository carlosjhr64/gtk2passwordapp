#!/usr/bin/env ruby
require 'rubygems'
gem 'gtk2applib', '~> 15.3'
require 'gtk2applib'
require 'gtk2passwordapp'

if $options=~/-no-gui/ then
  print Gtk2Password::Configuration::COMMAND_LINE_MSG1
  pwd = $stdin.gets.strip
  passwords = Gtk2Password::Passwords.new(Gtk2Password::Configuration::PASSWORDS_FILE, pwd)
  print Gtk2Password::Configuration::COMMAND_LINE_MSG2
  pattern = Regexp.new( $stdin.gets.strip, Regexp::IGNORECASE )
  passwords.accounts.each do |account|
    if account =~ pattern then
      password = passwords.password_of(account)
      puts "\t\"" + account + "\"\t\t" + password
    end
  end
  exit
end

program = Gtk2AppLib::Program.new( Gtk2Password::ABOUT )

begin
  Gtk2Password::App.new(program)
rescue Exception
  $!.puts_bang!
ensure
  program.finalize
end

